<link rel="stylesheet" type="text/css" href="../auto-number-title.css" />

# LCP-2021A 使用手册-附录

| 版本 | 作者 | 说明 |
|----|----|----|
| 2021G | 小林博士 | 初始版本 |

[toc]

## 附录B：输出文件格式说明

本程序每个步骤都有输出，大部分步骤输出的文件将作为下一步骤的输入，有些步骤输出数据表格，可能会有多个格式，此时不同格式内容相同，只是为了满足不同需求。如果希望将其中某一个步骤用自己的程序替换，只要确保输出文件格式一致即可。以下讨论时涉及到的文件名，都以系统默认配置为准。

### 本底平场合并和改正

输出`bias.fits`和`'flat_{band}.fits`，科学图像改正后输出为`xxxx_bf.fit`。改正后科学图像会在文件头加入新记录（或更新原有记录），包括：`RA`, `DEC`, `LST`, `HA`, `JD`, `MJD`, `BJD`, `HJD`, `AZ`, `ALT`, `AIRMASS`, `SITEELEV`, `SITELAT`, `SITELONG`。

### 测光

利用Source-Extractor对改正后的图像进行测光，输出`xxxx_se.fits`，二进制星表。然后将其中的内容转换为本程序自己的格式，输出`xxxx_cat.fits`和`xxxx_cat.txt`，前者是Bin-Table FITS格式，数据位于Ext-1，而Ext-0只有头部，存放原fits头部。文本文件星表为二进制星表的备份，便于人工阅读。

后随步骤中，如果前一步骤输出分为二进制格式和文本格式的，原则上本程序读二进制格式，文本仅供人工阅读参考。如果输出只有文本，那么下一步骤读文本。

以下格式说明中，数据类型表示二进制表所用的数据类型，数据格式表示输出成文本时的转换格式。若无特殊情况，列名在二进制文件和文本文件是相同的。

| 列名 | 数据类型 | 数据格式 | 内容 |
|:---|-------:|-------:|:-------|
| Num   | uint16  | 4d   | 序号 |
| X     | float64 | 8.3f | 星像中心X坐标，1开始 |
| Y     | float64 | 8.3f | |
| Elong | float32 | 5.2f | 伸长率，即长轴比短轴 |
| FWHM  | float32 | 5.2f | 半高全宽，像素单位 |
| Mag   | float32 | 6.3f | 仪器星等 |
| Err   | float32 | 6.4f | 星等误差 |
| Flags | uint16  |  16b | SE标志位 |
| Alpha | float64 | 10.6f | 赤经，度，如果缺WCS信息，则为0 |
| Delta | float64 | +10.6f| 赤纬，度 |

### 图像对齐

输出`offset_{obj}_{band}.txt`，本步骤只输出文本。该文件表示每幅图像相对基准图像的位移，每行一张图像。

| 列名 | 数据格式 | 内容 |
|:---|-------:|:-------|
| No       |    3d | 序号 |
| Filename |   20s | 文件名 |
| Cnt      |    4d | 全图有几颗星参与匹配 |
| It       |    2d | 匹配几轮结束 |
| X_Med    | +8.3f | X方向偏差中值 |
| X_Std    |  7.4f | X方向偏差标准差 |
| Y_Med    | +8.3f | 同上 |
| Y_Std    |  7.4f | 同上 |
| Mag_Med  | +7.3f | 匹配后星等差中值 |
| Mag_Std  |  7.4f | 星等差标准差 |
| T_JD     | 10.6f | 文件JD-2458000 |

### 猜测目标和参考星

输出`pick_{obj}_{band}.txt`，但是注意，本文件仅供人工阅读，不作为后续程序输入。本程序内部自动将选取的目标传递给下一步骤。

| 列名 | 数据格式 | 内容 |
|:---|-------:|:-------|
| GNo | 3d | 在基准星表中的原始编号 |
| X   | 7.2f | 在基准星表中的X坐标 |
| Y   | 7.2f | 同上 |
| Mag | 5.2f | 在基准星表中的仪器星等 |
| Std | 7.3f | 在所有图像中的标准差 |
| Dif | 7.3f | 在所有图像中的最大与最小星等差 |
| Var | 3s | 是否被认为是变星，如果是，写`var`，否则写`---` |
| Ref | 3s | 是否被认为是参考星，如果是，写`ref`，否则写`---` |

### 提取指定星信息

输出`cat_{obj}_{band}.fits`, `cattb_{obj}_{band}.txt`, `catls_{obj}_{band}.txt`等3个星表，以及`cat_{obj}_{band}.png`。证认图显示基准图像，并且标出选定星的位置和编号。

`cat_{obj}_{band}.fits` 二进制星表格式，每行为一个文件中的星，其中星的信息是N元数组。

| 列名 | 数据类型 | 内容 |
|:---|-------:|:-------|
| File  | (str, 20) | 文件名 |
| Band  | (str, 10) | 波段 |
| Expt  | float32   | 曝光时间 |
| DT    | (str, 22) | 观测时间日期，yyyy-mm-ddTHH:MM:SS.ss |
| JD    | float64   | 观测时间儒略日 |
| BJD   | float64   | BJD |
| X     | float64*n | n颗目标X的坐标 |
| Y     | float64*n | 同上 |
| Mag   | float32*n | 仪器星等 |
| Err   | float32*n | 误差 |
| FWHM  | float32*n | 半高全宽 |
| Elong | float32*n | 伸长率 |
| Idx   | int*n     | 在原星表中序号 |

`cattb_{obj}_{band}.txt`，文本格式，每行一个文件，同样的，每行中有N颗星的数据，以00结尾的列，可能有N组。

| 列名 | 数据格式 | 内容 |
|:---|-------:|:-------|
| File    | s | 文件名 |
| Band    | 5s | 波段 |
| ExpTime | 5.1f | 曝光时间 |
| DT      | 22s | 观测日期时间 |
| JD      | 15.7f | JD |
| BJD     | 15.7f | BJD |
| ID00    | 4d | 第i颗星在原星表中的序号 |
| X00     | 6.1f | X坐标 |
| Y00     | 6.1f | Y |
| Mag00   | 7.4f | 仪器星等 |
| Err00   | 6.4f | 星等误差 |

`catls_{obj}_{band}.txt`，文本格式，每行为一颗星，nf幅图像，每幅图像选ns颗星，一共有nf*ns行。

| 列名 | 数据格式 | 内容 |
|:---|-------:|:-------|
| DT      | 22s | 观测日期时间 |
| Mag   | 7.4f | 仪器星等 |
| ExpTime | 5.1f | 曝光时间 |
| Band    | 5s | 波段 |
| File    | s | 文件名 |
| BJD     | 15.7f | BJD |
| Err   | 6.4f | 星等误差 |
| No  | 2d | 星序号 |
| FWHM | 5.2f | 半高全宽 |
| Elongation | 5.3f | 伸长率 |
| JD      | 15.7f | JD |
| ID    | 4d | 第i颗星在原星表中的序号 |
| X     | 6.1f | X坐标 |
| Y     | 6.1f | Y |

### 较差测光

输出`cali_{obj}_{band}.fits`和`cali_{obj}_{band}.txt`，其中前者为二进制表，参考星和校验星数据为多组。后者为文本文件。二进制列和文本列对应关系同上，下面只列出二进制数据列。两种格式都是每行表示一幅图像的数据。

| 列名 | 数据类型 | 数据格式 | 内容 |
|:---|-------:|-------:|:-------|
| File     | (str, 20) |   s | 文件名 |
| DT       | (str, 22) | 22s | 观测日期时间，格式同前 |
| JD       | float64 | 15.7f | JD |
| BJD      | float64 | 15.7f | BJD |
| CaliCst  | float32 |  6.3f | 定标常数，是参考星的均值 |
| MagTgt   | float32 |  6.3f | 目标星仪器星等 |
| CaliTgt  | float32 |  6.3f |  目标星校正后星等 |
| ErrTgt   | float32 |  6.3f |  目标星测光误差 |
| MagRef   | float32*n_ref |  6.3f |  参考星仪器星等，多列 |
| ErrRef   | float32*n_ref |  6.3f |  同上 |
| MagChk   | float32*n_chk |  6.3f |  同上 |
| CaliChk  | float32*n_chk |  6.3f |  同上 |
| ErrChk   | float32*n_chk |  6.3f |  同上 |

### 光变曲线绘制

输出`lc_{obj}_{band}.png`，上部是目标星光变曲线，下部是校验星光变曲线，在图例中会标出校验星的序号和标准差。
